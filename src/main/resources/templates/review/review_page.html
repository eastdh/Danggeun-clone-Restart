<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>review page</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/src/main/resources/static/css/style.css" />
    <link rel="stylesheet" th:href="@{/css/review/review_page.css}" href="/src/main/resources/static/css/review/review_page.css" />
  </head>
  <body>
    <section class="review-page">
      <div class="review-header">
        <div class="review-header__left">
          <img th:src="@{${review?.profileImage} ?: '/assets/images/chat_test_pic.jpg'}" alt="프로필 이미지" class="profile-img" />
          <div class="profile-info">
            <h2 class="profile-name" th:text="${review?.nickname ?: '닉네임'}">닉네임</h2>
            <div class="profile-rating">⭐ <span th:text="${review?.avgRating ?: '4.8'}">4.8</span> / 5.0</div>
          </div>
        </div>
        <div class="review-header__right">
          <h3>이런 점이 좋았어요</h3>

          <ul class="received-keywords structured" th:if="${receivedKeywords != null and #lists.size(receivedKeywords) > 0}">
            <li th:each="keywordStat : ${receivedKeywords}">
              <span class="keyword-count" th:text="${keywordStat.count + '명'}">0명</span>
              <span class="keyword-text" th:text="${keywordStat.keyword}">키워드</span>
            </li>
          </ul>

          <div class="no-keywords" th:if="${receivedKeywords == null or #lists.isEmpty(receivedKeywords)}">아직 받은 키워드가 없어요 😊</div>
        </div>
      </div>

      <div class="review-divider"></div>

      <form id="reviewForm" class="review-form" method="post" th:action="@{/review/submit}">
        <section class="form-section">
          <div class="form-title">
            <span>별점을 선택해주세요!</span>
            <span class="form-badge">최대 5점</span>
          </div>
          <div class="form-subtitle">별을 클릭하면 점수가 표시됩니다</div>
          <div class="rating-wrapper">
            <div class="rating">
              <label
                class="rating-label"
                th:each="i : ${#numbers.sequence(1, 10)}"
                th:classappend="${i % 2 == 1} ? 'rating-label--half' : 'rating-label--full'"
                th:for="${'star' + i}"
              >
                <input type="radio" th:id="${'star' + i}" th:name="rating" th:value="${i}" class="rating__input" />
                <span class="star-icon"></span>
              </label>
            </div>
            <div class="rating-value-display" id="ratingValue"></div>
          </div>
        </section>

        <section class="form-section">
          <div class="form-title">
            <span>리뷰 키워드</span>
            <span class="form-badge">1~5개</span>
          </div>
          <div class="form-subtitle">어떤 점이 좋았나요?</div>
          <div class="keyword-options">
            <label th:each="keyword : ${availableKeywords}">
              <input
                type="checkbox"
                name="keywords"
                th:value="${keyword.name}"
                th:checked="${review.keywords != null and review.keywords.contains(keyword.name)}"
              />
              <span th:text="${keyword.name}">키워드</span>
            </label>
          </div>
        </section>

        <section class="form-section">
          <div class="form-title">
            <span>리뷰 작성</span>
            <span class="form-badge">최대 200자</span>
          </div>
          <div class="review-guide" id="reviewGuide">
            <p class="guide-bubble loading">💬 가이드를 불러오는 중입니다...</p>
            <p class="guide-bubble loading">🌱 잠시만 기다려주세요!</p>
          </div>

          <div class="review-text">
            <textarea
              id="reviewContent"
              name="content"
              rows="5"
              required
              maxlength="200"
              placeholder="리뷰 내용을 작성해주세요"
              th:text="${review?.content ?: ''}"
            ></textarea>
            <div id="charCounter" class="char-counter">0 / 200자</div>
          </div>
        </section>

        <div class="review-buttons">
          <button type="submit" class="btn-submit" th:text="${mode == 'edit'} ? '수정' : '등록'">등록</button>
          <button type="reset" class="btn-cancel">취소</button>
        </div>
      </form>
    </section>
    <script th:src="@{/js/review/review_page.js}" src="/src/main/resources/static/js/review/review_page.js"></script>
  </body>
</html>
