<!-- chat_page.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>chat page</title>
    <link rel="stylesheet" th:href="@{/css/chat/chat_page.css}" />
  </head>
  <body>
    <div class="chat-page">
      <!-- chat-list -->
      <div class="list">
        <div class="list__header">
          <div class="list__header__user-id" th:text="${userNickname} ?: '내 닉네임'" th:attr="data-user-id=${userId}">내 닉네임</div>

          <div class="list__header__toggle">
            <span>안 읽은 채팅</span>
            <label class="list__header__toggle-switch">
              <input type="checkbox" th:checked="${showUnreadOnly}" onchange="toggleUnreadOnly(this.checked)" />
              <span class="list__header__toggle-slider"></span>
            </label>
          </div>
        </div>
        <div class="list__room-list">
          <!-- 채팅방 리스트 아이템 -->
          <div th:if="${#lists.isEmpty(chatRooms)}" class="list__empty-message">
            <p class="empty-message__title">아직 시작된 채팅이 없어요</p>
            <p class="empty-message__subtitle">
              거래 상세 페이지에서 <strong>‘채팅하기’ 버튼</strong>을 누르면 <br />
              대화를 시작할 수 있어요.<br />
              관심 있는 상품을 먼저 둘러보는 건 어때요?
            </p>
            <a th:href="@{/trade}" class="empty-message__browse-button">거래글 둘러보기</a>
          </div>
          <div
            class="list__room-list__item"
            th:each="room : ${chatRooms}"
            th:attr="data-chat-room-id=${room.chatRoomId}"
            th:onclick="|selectRoom(${room.chatRoomId})|"
          >
            <div class="list__room-list__item-content">
              <div class="list__room-list__item-meta">
                <span class="list__room-list__item-meta__partner-id" th:text="${room.partnerNickname} ?: '상대방'">상대방</span>
                <div class="list__room-list__item-meta__location" th:text="${room.partnerLocation}">강남구</div>
                <div class="list__room-list__item-meta__timestamp" th:text="${room.lastMessageTime}">1시간 전</div>
                <span class="unread-badge" th:if="${room.unreadCount > 0}" th:text="${room.unreadCount}">3</span>
              </div>
              <div class="list__room-list__item__preview" th:text="${room.lastMessageContent} ?: '메시지 미리보기'">메시지 미리보기</div>
            </div>
            <img class="thumbnail" th:src="@{${room.tradeThumbnailUrl} ?: '/assets/icon/default_product_img.svg'}" />
          </div>
        </div>
      </div>

      <!-- chat-room -->
      <div class="room">
        <div class="room__empty-message" id="roomEmptyMessage">
          <p class="empty-message__title">채팅방이 선택되지 않았어요</p>
          <p class="empty-message__subtitle">
            왼쪽에서 채팅방을 선택하면<br />
            상대방과의 메시지를 확인하고 거래를 진행할 수 있어요.
          </p>
          <div class="empty-message__arrow-indicator">👈</div>
        </div>
        <div class="room__selected-room" id="roomSelected" style="display: none">
          <div class="room__header">
            <!-- 상대방 정보 -->
            <div class="room__header__partner-info">
              <span class="room__header__partner-info__id"></span>
              <span class="room__header__partner-info__temperature"></span>
            </div>

            <!-- 거래 정보 -->
            <div class="room__header__trade-info">
              <div class="room__header__trade-info__product">
                <img class="thumbnail" />
                <div class="room__header__trade-info__product-meta">
                  <div class="room__header__trade-info__product__name"></div>
                  <div class="room__header__trade-info__product__price"></div>
                </div>
              </div>

              <!-- 거래 상태 버튼: 항상 렌더링 -->
              <button id="tradeStatusButton" class="room__header__trade-info__status-button" type="button" data-chat-room-id="" data-trade-id="">
                거래 상태
              </button>
            </div>
          </div>
          <!-- 채팅 메시지 반복 -->
          <div class="room__messages"></div>

          <div class="room__input-area">
            <div class="room__input-area__wrapper">
              <textarea class="room__input-area__field" placeholder="메시지를 입력하세요"></textarea>
              <button class="room__input-area__send-button">전송</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script th:src="@{/js/chat/chat_page.js}"></script>
  </body>
</html>
